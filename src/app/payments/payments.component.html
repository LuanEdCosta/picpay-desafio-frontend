<div class="container">
  <app-header></app-header>

  <div class="content">
    <div class="content-header">
      <h1 class="content-title">Meus Pagamentos</h1>
      <app-button (click)="setIsAddingPayment()" size="small" [withIcon]="true">
        <span>Adicionar Pagamento</span>
        <i-feather name="plus"></i-feather>
      </app-button>
    </div>

    <div class="content-data">
      <div class="content-data-header">
        <form
          class="content-data-header-filters"
          (submit)="filterPayments($event)"
        >
          <app-input color="background" size="small">
            <input
              type="text"
              placeholder="Pesquisar por usuário..."
              [ngModelOptions]="{ standalone: true }"
              [(ngModel)]="search"
            />

            <i-feather
              class="content-data-header-filters-search-icon"
              name="search"
              right
            ></i-feather>
          </app-input>

          <app-button type="submit" color="snow" size="small" [withIcon]="true">
            <i-feather name="sliders"></i-feather>
            <span>Filtrar</span>
          </app-button>
        </form>

        <div class="content-data-header-pagination">
          <div class="content-data-header-pagination-limiter">
            <span>Exibir:</span>
            <select [(ngModel)]="rowsPerPage" (change)="changeRowsPerPage()">
              <option
                *ngFor="let numberOfRows of rowsPerPageOptions"
                [value]="numberOfRows"
              >
                {{ numberOfRows }}
              </option>
            </select>
          </div>

          <app-pagination
            [totalOfPages]="getTotalOfPages()"
            [selectedPage]="currentPage"
            (changePage)="changePage($event)"
          ></app-pagination>
        </div>
      </div>

      <table class="content-data-table">
        <thead class="content-data-table-head">
          <tr class="content-data-table-head-row">
            <th
              class="content-data-table-head-row-col"
              *ngFor="let column of tableColumns"
            >
              <div
                [ngClass]="{
                  'content-data-table-head-row-col-text': true,
                  'col-text-center': column.centered
                }"
                (click)="setSortBy(column.key)"
              >
                <span>{{ column.label }}</span>

                <i-feather
                  *ngIf="sortBy === column.key"
                  [name]="sortOrder === 'asc' ? 'chevron-down' : 'chevron-up'"
                ></i-feather>
              </div>
            </th>

            <th></th>
          </tr>
        </thead>

        <tbody class="content-data-table-body">
          <tr
            class="content-data-table-body-row"
            *ngFor="let payment of payments"
          >
            <td class="content-data-table-body-row-col">
              <div>{{ payment.name }}</div>
              <div>@{{ payment.username }}</div>
            </td>

            <td class="content-data-table-body-row-col">{{ payment.title }}</td>

            <td class="content-data-table-body-row-col">
              <div>{{ payment.date | date: 'd MMM y':'':'pt-BR' }}</div>
              <div>{{ payment.date | date: 'shortTime':'':'pt-BR' }}</div>
            </td>

            <td class="content-data-table-body-row-col">
              R$ {{ payment.value | number: '':'pt-BR' }}
            </td>

            <td class="content-data-table-body-row-col col-center">
              <i-feather
                [ngClass]="payment.isPayed ? 'paid' : 'not-paid'"
                [name]="payment.isPayed ? 'check-circle' : 'x-circle'"
              ></i-feather>
            </td>

            <td class="content-data-table-body-row-actions">
              <app-icon-button (click)="setPaymentToEdit(payment)">
                <i-feather name="edit-2"></i-feather>
              </app-icon-button>

              <app-icon-button (click)="setPaymentToDelete(payment)">
                <i-feather name="trash"></i-feather>
              </app-icon-button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-alert-modal
  modalTitle="Excluir Pagamento"
  [isOpen]="!!this.paymentToDelete"
  (closeModal)="setPaymentToDelete(undefined)"
>
  <div class="delete-payment-modal">
    <div class="delete-payment-modal-data">
      <strong>Usuário:</strong>
      <span>{{ paymentToDelete?.name }}</span>
    </div>

    <div class="delete-payment-modal-data">
      <strong>Data:</strong>
      <span>{{ paymentToDelete?.date | date: 'd MMM y':'':'pt-BR' }}</span>
    </div>

    <div class="delete-payment-modal-data">
      <strong>Valor:</strong>
      <span>R$ {{ paymentToDelete?.value | number: '':'pt-BR' }}</span>
    </div>

    <div class="delete-payment-modal-actions">
      <app-button
        (click)="setPaymentToDelete(undefined)"
        color="snow"
        size="small"
        [withIcon]="true"
      >
        <span>Cancelar</span>
        <i-feather name="x"></i-feather>
      </app-button>

      <app-button
        (click)="deletePayment()"
        color="danger"
        size="small"
        [withIcon]="true"
      >
        <span>Excluir</span>
        <i-feather name="trash"></i-feather>
      </app-button>
    </div>
  </div>
</app-alert-modal>

<app-payment-modal
  [isOpen]="isShowingPaymentModal"
  (closeModal)="closePaymentModal()"
  [paymentToEdit]="paymentToEdit"
  (savePayment)="paymentToEdit ? editPayment($event) : savePayment($event)"
></app-payment-modal>
